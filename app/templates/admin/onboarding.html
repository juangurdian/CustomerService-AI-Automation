{% extends "base.html" %}

{% block title %}Configuraci√≥n Inicial - {{ config.business.name }}{% endblock %}

{% block content %}
<div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">Configuraci√≥n Inicial</h1>
    <p class="text-gray-600">Sigue estos pasos para configurar tu asistente virtual</p>
</div>

<div class="max-w-3xl">
    <!-- Progress Bar -->
    {% set completed_checks = checks.values() | select | list | length %}
    {% set total_checks = checks.values() | list | length %}
    {% set progress_percent = (completed_checks / total_checks * 100) | round %}
    
    <div class="mb-8">
        <div class="flex justify-between text-sm text-gray-600 mb-2">
            <span>Progreso de configuraci√≥n</span>
            <span>{{ completed_checks }}/{{ total_checks }} completado</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-blue-600 h-2 rounded-full" style="width: {{ progress_percent }}%"></div>
        </div>
    </div>
    
    <!-- Checklist -->
    <div class="space-y-4">
        <!-- Step 1: Environment -->
        <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 {{ 'border-green-500' if checks.env_file else 'border-gray-300' }}">
            <div class="flex items-center mb-4">
                <div class="text-2xl mr-3">{{ '‚úÖ' if checks.env_file else '‚è≥' }}</div>
                <h3 class="text-lg font-semibold">1. Configurar Variables de Entorno</h3>
            </div>
            
            {% if checks.env_file %}
                <p class="text-green-600 mb-2">‚úì Archivo .env configurado</p>
            {% else %}
                <p class="text-gray-600 mb-4">Copia el archivo .env.example a .env y configura tus API keys</p>
                <div class="bg-gray-50 p-4 rounded font-mono text-sm">
                    cp .env.example .env<br>
                    # Luego edita .env con tus llaves
                </div>
            {% endif %}
        </div>
        
        <!-- Step 2: Config -->
        <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 {{ 'border-green-500' if checks.config_file else 'border-gray-300' }}">
            <div class="flex items-center mb-4">
                <div class="text-2xl mr-3">{{ '‚úÖ' if checks.config_file else '‚è≥' }}</div>
                <h3 class="text-lg font-semibold">2. Configurar Informaci√≥n del Negocio</h3>
            </div>
            
            {% if checks.config_file %}
                <p class="text-green-600 mb-2">‚úì Archivo config.yaml configurado</p>
            {% else %}
                <p class="text-gray-600 mb-4">Copia y personaliza la configuraci√≥n de tu negocio</p>
                <div class="bg-gray-50 p-4 rounded font-mono text-sm">
                    cp config_example.yaml config.yaml<br>
                    # Edita con info de tu negocio
                </div>
            {% endif %}
        </div>
        
        <!-- Step 3: FAQs -->
        <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 {{ 'border-green-500' if checks.faqs_data else 'border-gray-300' }}">
            <div class="flex items-center mb-4">
                <div class="text-2xl mr-3">{{ '‚úÖ' if checks.faqs_data else '‚è≥' }}</div>
                <h3 class="text-lg font-semibold">3. Cargar Preguntas Frecuentes</h3>
            </div>
            
            {% if checks.faqs_data %}
                <p class="text-green-600 mb-2">‚úì FAQs cargadas desde data/faqs.csv</p>
                <a href="/admin/knowledge" class="text-blue-600 hover:underline">Ver y editar FAQs ‚Üí</a>
            {% else %}
                <p class="text-gray-600 mb-4">Crea tu archivo de preguntas frecuentes</p>
                <div class="bg-gray-50 p-4 rounded text-sm">
                    <p class="font-semibold mb-2">Formato esperado (data/faqs.csv):</p>
                    <code>question,answer,tags<br>
                    "¬øCu√°les son sus horarios?","Abrimos de 8am a 6pm","horarios"<br>
                    "¬øD√≥nde est√°n ubicados?","Estamos en...","ubicacion"</code>
                </div>
                <a href="/admin/knowledge" class="inline-block mt-3 text-blue-600 hover:underline">Ir a Base de Conocimiento ‚Üí</a>
            {% endif %}
        </div>
        
        <!-- Step 4: Menu -->
        <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 {{ 'border-green-500' if checks.menu_data else 'border-gray-300' }}">
            <div class="flex items-center mb-4">
                <div class="text-2xl mr-3">{{ '‚úÖ' if checks.menu_data else '‚è≥' }}</div>
                <h3 class="text-lg font-semibold">4. Configurar Men√∫/Productos</h3>
            </div>
            
            {% if checks.menu_data %}
                <p class="text-green-600 mb-2">‚úì Men√∫ cargado desde data/menu.csv</p>
                <a href="/admin/menu" class="text-blue-600 hover:underline">Ver y editar men√∫ ‚Üí</a>
            {% else %}
                <p class="text-gray-600 mb-4">Crea tu archivo de men√∫</p>
                <div class="bg-gray-50 p-4 rounded text-sm">
                    <p class="font-semibold mb-2">Formato esperado (data/menu.csv):</p>
                    <code>name,price,description,category,available<br>
                    "Pizza Margherita",12.99,"Pizza cl√°sica con queso","pizza",true<br>
                    "Hamburguesa Cl√°sica",8.50,"Carne, lechuga, tomate","hamburguesa",true</code>
                </div>
                <a href="/admin/menu" class="inline-block mt-3 text-blue-600 hover:underline">Ir a Gesti√≥n de Men√∫ ‚Üí</a>
            {% endif %}
        </div>
        
        <!-- Step 5: Index -->
        <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 {{ 'border-green-500' if checks.index_built else 'border-gray-300' }}">
            <div class="flex items-center mb-4">
                <div class="text-2xl mr-3">{{ '‚úÖ' if checks.index_built else '‚è≥' }}</div>
                <h3 class="text-lg font-semibold">5. Construir √çndice de B√∫squeda</h3>
            </div>
            
            {% if checks.index_built %}
                <p class="text-green-600 mb-2">‚úì √çndice de b√∫squeda construido</p>
                <button onclick="rebuildIndex()" class="text-blue-600 hover:underline">Re-construir √≠ndice</button>
            {% else %}
                <p class="text-gray-600 mb-4">Construye el √≠ndice para que el bot pueda buscar informaci√≥n</p>
                <button onclick="rebuildIndex()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                    Construir √çndice Ahora
                </button>
            {% endif %}
        </div>
    </div>
    
    <!-- Next Steps -->
    {% if completed_checks == total_checks %}
    <div class="mt-8 bg-green-50 border border-green-200 p-6 rounded-xl">
        <h3 class="text-lg font-semibold text-green-800 mb-2">üéâ ¬°Configuraci√≥n Completa!</h3>
        <p class="text-green-700 mb-4">Tu asistente virtual est√° listo para usar. Pr√≥ximos pasos:</p>
        
        <div class="space-y-2">
            <a href="/admin/playground" class="block text-blue-600 hover:underline">‚Ä¢ Probar el bot en el playground</a>
            <a href="/demo" target="_blank" class="block text-blue-600 hover:underline">‚Ä¢ Ver el chat demo</a>
            <a href="/admin/channels" class="block text-blue-600 hover:underline">‚Ä¢ Configurar WhatsApp/Telegram</a>
            <a href="/admin/analytics" class="block text-blue-600 hover:underline">‚Ä¢ Revisar anal√≠tica</a>
        </div>
    </div>
    {% endif %}
</div>

<script>
async function rebuildIndex() {
    const button = event.target;
    const originalText = button.textContent;
    
    button.textContent = 'Construyendo...';
    button.disabled = true;
    
    try {
        const response = await fetch('/admin/rebuild-index', { method: 'POST' });
        if (response.ok) {
            location.reload();
        } else {
            alert('Error al construir el √≠ndice');
            button.textContent = originalText;
            button.disabled = false;
        }
    } catch (error) {
        alert('Error: ' + error.message);
        button.textContent = originalText;
        button.disabled = false;
    }
}
</script>
{% endblock %}